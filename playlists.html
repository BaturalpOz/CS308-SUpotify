<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://bootswatch.com/4/lux/bootstrap.min.css">
    <title>Playlists</title>
    <style>
        body {
            background-color: #ffffff;
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        .navbar {
            background-color: #0F4C8F;
        }
        .navbar-brand, .navbar-nav .nav-link {
            color: #ffffff;
            font-size: 30px;
        }
        .navbar-toggler-icon {
            background-color: #ffffff;
        }
        .playlist-list {
            padding: 20px;
            text-align: center;
            max-width: 800px; /* Centering playlists */
            margin: auto;
        }
        .playlist-list-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .playlist-name {
            flex-grow: 1;
            font-weight: bold;
            font-size: 1.5rem;
        }
        .navbar-bottom {
            background-color: #0F4C8F;
            position: fixed;
            bottom: 0;
            width: 100%;
            z-index: 999;
        }
        .navbar-bottom .navbar-brand {
            color: #ffffff;
            font-size: 20px;
        }
        /* Custom styles for playlists */
        #playlist-list > li {
            background-color: #e9ecef;
            border-radius: 0.25rem;
            margin-bottom: 1rem;
            padding: 0.5rem;
            list-style: none; /* No bullets */
        }
        #playlist-list > li > ul {
            padding-left: 1.5rem;
            list-style: none; /* No bullets for songs */
            padding-bottom: 0.5rem;
        }
        #playlist-list > li > ul > li {
            padding: 0.5rem 0;
            border-top: 1px solid #ccc;
        }
        #playlist-list > li > ul > li:first-child {
            border-top: none;
        }
    </style>
</head>
<body>
    <!-- Top Navbar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="playlists.html">SUpotify zp Playlists</a>
            <button class="btn btn-primary ml-auto" onclick="window.location.href='add_playlist.html'">Add Playlist</button>
            <button class="btn btn-danger" onclick="window.location.href='delete_playlist.html'">Delete Playlist</button>
        </div>
    </nav>

    <!-- Playlist List -->
    <div class="playlist-list">
        <h2>List of all playlists</h2>
        <ul id="playlist-list" class="list-group">
            <!-- Playlists will be dynamically added here -->
        </ul>
    </div>

    <!-- Bottom Navbar -->
    <nav class="navbar navbar-bottom">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Â© 2023 SUpotify</a>
        </div>
    </nav>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        $(document).ready(function() {
            loadPlaylists();
        });
    
        function loadPlaylists() {
            var userId = getUserIDFromToken(); // Retrieve user ID from token
    
            $.ajax({
                type: 'GET',
                url: `http://127.0.0.1:5001/user/get-all-playlists`,
                xhrFields: {
                    withCredentials: true
                },
                success: function(response) {
                                console.log(response); // Log the server response
                                var playlists = response.playlists;
                                $('#playlist-list').empty(); // Ensure the correct ID is used
                                // Iterate over the response object
                                for (var playlistName in playlists) {
                                    // Check if the property is an actual playlist and not an inherited one
                                    if (playlists.hasOwnProperty(playlistName)) {
                                        // Create a list item for each playlist
                                        var listItem = '<li><a href="playlist_details.html?playlist_name=' + encodeURIComponent(playlistName) + '">' + playlistName +'</a> <ul>';
                                        // Iterate over the songs in each playlist
                                        playlists[playlistName].forEach(function(song) {
                                            listItem += '<li>' + song + '</li>';
                                        });
                                        listItem += '</ul></li>';
                                        // Append the list item to the playlist list
                                        $('#playlist-list').append(listItem);
                }
            }
        },
                error: function(xhr, status, error) {
                    console.log('Error loading playlists:', xhr.responseText, status, error);
                }
            });
        }
    
        function getUserIDFromToken() {
            var token = getCookie('access_token_cookie');
            if (!token) {
                console.log("Token not found");
                return null;
            }
        
            var payload = parseJwt(token);
            return payload ? payload.user_id : null;
        }
    
        function getCookie(name) {
            var value = "; " + document.cookie;
            var parts = value.split("; " + name + "=");
            if (parts.length === 2) {
                return parts.pop().split(";").shift();
            }
            return null;
        }
    
        function parseJwt(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
    
            return JSON.parse(jsonPayload);
        }
    </script>
    
</body>
</html>